---
layout: post
title: "C++ Swig使用"
description: C++ Swig使用
modified: 2022-01-01
category: C++
tags: [C++]
---

# 一、使用

1.下载swigwin-4.0.2.zip，解压后路径配置到Windows PATH环境变量中。文件夹中包含pylib1.i，pylib1.h。执行如下命令，生成pylib1.py，pylib1_wrap.cxx两个文件。
    
    # -c++：Enable C++ processing
    # -python：Generate Python wrappers
    swig -c++ -python pylib1.i

pylib1.i：

    %module pylib1
    %{
    #include "pylib1.h"
    %}
    
    %include "pylib1.h"

pylib1.h：

    #ifndef PYLIB1_PYLIB1_H
    #define PYLIB1_PYLIB1_H
    
    void hello();
    
    #endif //PYLIB1_PYLIB1_H

2.将上一步产生的pylib1_wrap.cxx编译为pylib1_wrap.o文件。

    # -O2：最安全的优化
    # -fPIC：作用于编译阶段，告诉编译器产生与位置无关代码(Position-Independent Code)
    # -c：只编译不链接，只生成目标文件。
    # -I：python头文件所在路径
    g++ -O2 -fPIC -c pylib1_wrap.cxx -I/usr/local/include/python3.7m/

3.原始的cpp文件，用Clion remote host build生成libpylib1.so文件。

    cd cmake-build-debug/
    cp libpylib1.so ../doc/swig/

4.将pylib1_wrap.o再进行编译，并与动态库libpylib1.so进行链接，生成可以被python调用的_pylib1.so

    # -shared：指定生成动态链接库
    # −L：库文件所在路径
    # −l：库名
    # -rpath：后面的参数是libpylibproj.so所在路径
    g++ -shared pylib1_wrap.o -L./ -lpylib1 -Xlinker -rpath ./ -o _pylib1.so

5.安装python模块并调用

    cp _pylib1.so /usr/local/lib/python3.7/site-packages/pylib1/
    cp pylib1.py /usr/local/lib/python3.7/site-packages/pylib1/
    cp libpylib1.so /usr/local/lib/
    ldconfig

在python程序中调用：

    from pylib1 import pylib1
    
    # 将输出Hello World！   
    pylib1.hello()

# 二、参考

1.[SWIG的简介、安装、使用方法之详细攻略](https://blog.csdn.net/qq_41185868/article/details/103558686)

2.[Swig官网](http://www.swig.org/)

3.[swig步骤说明](https://blog.csdn.net/buer0/article/details/99636732)
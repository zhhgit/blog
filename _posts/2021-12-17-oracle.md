---
layout: post
title: "Oracle基础"
description: Oracle基础
modified: 2021-12-17
category: Database
tags: [Database]
---

# 一、基础

    -- 查看版本
    select * from v$version;

    -- 创建用户
    CREATE USER OT IDENTIFIED BY Orcl1234;

    -- 给用户赋予connect、resource和dba三种标准角色。
    -- Connect 角色，是授予最终用户的典型权利，最基本的权利，能够连接到ORACLE数据库中，并在对其他用户的表有访问权限时，做SELECT、UPDATE、INSERTT等操作。
    -- Resource 角色，是授予开发人员的，能在自己的方案中创建表、序列、视图等。
    -- DBA角色，是授予系统管理员的，拥有该角色的用户就能成为系统管理员了，它拥有所有的系统权限。
    GRANT CONNECT, RESOURCE, DBA TO OT;

    -- 使用OT用户帐户连接到数据库(ORCL)
    CONNECT ot@orcl

    -- 执行某个SQL脚本
    @F:\mypath\tbl_modify.sql

    -- 使用OT用户登录，查看当前用户能访问的表
    select owner, tablespace_name, table_name from all_tables order by owner, tablespace_name, table_name;
    
    -- 查询OT schema下的数据表名
    select owner, table_name, tablespace_name from dba_tables where owner='OT' order by table_name;

    -- 创建表
    CREATE TABLE "OT"."T_USER" (
    "ID" NUMBER(10,0) NOT NULL,
    "LOGIN_ID" VARCHAR2(255),
    "NAME" VARCHAR2(255),
    "CREATE_TIME" DATE
    );
    COMMENT ON COLUMN "OT"."T_USER"."ID" IS '主键ID';
    COMMENT ON COLUMN "OT"."T_USER"."LOGIN_ID" IS '登录ID';
    COMMENT ON COLUMN "OT"."T_USER"."NAME" IS '姓名';
    COMMENT ON COLUMN "OT"."T_USER"."CREATE_TIME" IS '创建时间';
    
    ALTER TABLE "OT"."T_USER" ADD CONSTRAINT "PK_USER_ID" PRIMARY KEY ("ID");

    -- 创建序列
    create sequence SEQ_T_USER_ID
    minvalue 1
    maxvalue 1E28
    start with 1
    increment by 1
    cache 20;

    -- 查看表结构，只在命令行模式下可用
    desc OT.T_USER;

    -- 合并数据，判断B表和A表是否满足ON中条件，如果满足则用B表去更新A表，如果不满足，则将B表数据插入A表
    MERGE INTO [target-table] A USING [source-table sql] B ON([conditional expression])
    WHEN MATCHED THEN
    [UPDATE sql]
    WHEN NOT MATCHED THEN
    [INSERT sql]

    -- 从上到下递归查询
    select txo.organization_id
    from test.t_xtgl_organization txo
    where txo.rec_status = '1'
    start with txo.organization_id = #{orgId,jdbcType=VARCHAR}
    connect by prior txo.organization_id = txo.parent_id

    -- 查看表空间使用情况
    select
    a.tablespace_name, total, free, total-free as used, substr(free/total * 100, 1, 5) as "FREE%", substr((total - free)/total * 100, 1, 5) as "USED%"
    from
    (select tablespace_name, sum(bytes)/1024/1024 as total from dba_data_files group by tablespace_name) a,
    (select tablespace_name, sum(bytes)/1024/1024 as free from dba_free_space group by tablespace_name) b
    where a.tablespace_name = b.tablespace_name
    order by a.tablespace_name

    -- 查看指定表空间各张表占用空间
    select * from (
    select t.tablespace_name,t.owner, t.segment_name, t.segment_type, sum(t.bytes / 1024 / 1024) mb
    from dba_segments t
    where t.segment_type='TABLE'
    group by t.tablespace_name,t.OWNER, t.segment_name, t.segment_type
    ) t where t.TABLESPACE_NAME = 'XXX_DATA'
    order by t.mb desc


# 二、去Oracle

使用AWS Schema Conversion Tool。

# 三、参考

1.[易百Oracle教程](https://www.yiibai.com/oracle)

2.[Oracle转PostgreSQL](https://blog.csdn.net/a13131234/article/details/110677786)

3.[AWS Schema Conversion Tool](https://docs.aws.amazon.com/zh_cn/SchemaConversionTool/latest/userguide/CHAP_Installing.html)